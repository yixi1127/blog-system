# 浏览器控制台测试脚本

在浏览器开发者工具的 Console 中运行以下脚本，可以快速测试 API 功能。

## 前置准备

1. 打开你的应用（http://localhost:8080 或其他端口）
2. 登录账号
3. 按 F12 打开开发者工具
4. 切换到 Console 标签

## 测试脚本

### 1. 测试创建文章

```javascript
// 创建测试文章
async function testCreateArticle() {
  const token = localStorage.getItem('token');
  
  const response = await fetch('/.netlify/functions/article-create', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      title: '浏览器测试文章 - ' + new Date().toLocaleString(),
      content: '这是通过浏览器控制台创建的测试文章。\n\n包含多行内容。\n\n测试时间：' + new Date().toLocaleString(),
      summary: '这是文章摘要',
      category: '技术分享',
      tags: ['测试', '浏览器', '控制台'],
      status: 'published'
    })
  });
  
  const result = await response.json();
  console.log('创建结果:', result);
  
  if (result.success) {
    console.log('✅ 创建成功！文章 ID:', result.article.id);
    window.testArticleId = result.article.id; // 保存 ID 供后续测试使用
    return result.article.id;
  } else {
    console.log('❌ 创建失败:', result.error);
  }
}

// 运行测试
testCreateArticle();
```

### 2. 测试获取文章列表

```javascript
// 获取文章列表
async function testGetArticleList() {
  const token = localStorage.getItem('token');
  
  const response = await fetch('/.netlify/functions/article-list?page=1&pageSize=10', {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  const result = await response.json();
  console.log('文章列表:', result);
  
  if (result.success) {
    console.log('✅ 获取成功！共', result.total, '篇文章');
    console.log('当前页文章:', result.list);
    return result.list;
  } else {
    console.log('❌ 获取失败:', result.error);
  }
}

// 运行测试
testGetArticleList();
```

### 3. 测试查看文章详情

```javascript
// 查看文章详情（使用之前创建的文章 ID）
async function testGetArticleDetail(articleId) {
  const token = localStorage.getItem('token');
  const id = articleId || window.testArticleId; // 使用传入的 ID 或之前保存的 ID
  
  if (!id) {
    console.log('❌ 请先创建文章或提供文章 ID');
    return;
  }
  
  const response = await fetch(`/.netlify/functions/article-detail?id=${id}`, {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  const result = await response.json();
  console.log('文章详情:', result);
  
  if (result.success) {
    console.log('✅ 获取成功！');
    console.log('标题:', result.article.title);
    console.log('分类:', result.article.category);
    console.log('标签:', result.article.tags);
    return result.article;
  } else {
    console.log('❌ 获取失败:', result.error);
  }
}

// 运行测试（使用之前创建的文章）
testGetArticleDetail();

// 或者指定文章 ID
// testGetArticleDetail(123);
```

### 4. 测试编辑文章

```javascript
// 编辑文章
async function testUpdateArticle(articleId) {
  const token = localStorage.getItem('token');
  const id = articleId || window.testArticleId;
  
  if (!id) {
    console.log('❌ 请先创建文章或提供文章 ID');
    return;
  }
  
  const response = await fetch('/.netlify/functions/article-update', {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      id: id,
      title: '浏览器测试文章（已更新）- ' + new Date().toLocaleString(),
      content: '这是更新后的内容。\n\n添加了新的段落。\n\n更新时间：' + new Date().toLocaleString(),
      summary: '这是更新后的摘要',
      category: '技术分享',
      tags: ['测试', '浏览器', '控制台', '已更新'],
      status: 'published'
    })
  });
  
  const result = await response.json();
  console.log('更新结果:', result);
  
  if (result.success) {
    console.log('✅ 更新成功！');
    return result.article;
  } else {
    console.log('❌ 更新失败:', result.error);
  }
}

// 运行测试
testUpdateArticle();
```

### 5. 测试搜索功能

```javascript
// 搜索文章
async function testSearchArticle(keyword) {
  const token = localStorage.getItem('token');
  
  const response = await fetch(`/.netlify/functions/article-list?title=${encodeURIComponent(keyword)}&page=1&pageSize=10`, {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  const result = await response.json();
  console.log('搜索结果:', result);
  
  if (result.success) {
    console.log('✅ 搜索成功！找到', result.total, '篇文章');
    console.log('文章列表:', result.list);
    return result.list;
  } else {
    console.log('❌ 搜索失败:', result.error);
  }
}

// 运行测试
testSearchArticle('测试');
```

### 6. 测试删除文章

```javascript
// 删除文章（谨慎使用！）
async function testDeleteArticle(articleId) {
  const token = localStorage.getItem('token');
  const id = articleId || window.testArticleId;
  
  if (!id) {
    console.log('❌ 请先创建文章或提供文章 ID');
    return;
  }
  
  const confirmed = confirm(`确定要删除文章 ${id} 吗？`);
  if (!confirmed) {
    console.log('已取消删除');
    return;
  }
  
  const response = await fetch('/.netlify/functions/article-delete', {
    method: 'DELETE',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      id: id.toString()
    })
  });
  
  const result = await response.json();
  console.log('删除结果:', result);
  
  if (result.success) {
    console.log('✅ 删除成功！');
    return true;
  } else {
    console.log('❌ 删除失败:', result.error);
  }
}

// 运行测试（会弹出确认对话框）
// testDeleteArticle();
```

## 完整测试流程

运行以下脚本可以自动执行完整的测试流程：

```javascript
// 完整测试流程
async function runFullTest() {
  console.log('🚀 开始完整测试...\n');
  
  try {
    // 1. 创建文章
    console.log('📝 步骤 1: 创建文章');
    const articleId = await testCreateArticle();
    if (!articleId) {
      console.log('❌ 测试终止：创建文章失败');
      return;
    }
    console.log('\n');
    
    // 等待 1 秒
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // 2. 获取列表
    console.log('📋 步骤 2: 获取文章列表');
    await testGetArticleList();
    console.log('\n');
    
    // 等待 1 秒
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // 3. 查看详情
    console.log('👀 步骤 3: 查看文章详情');
    await testGetArticleDetail(articleId);
    console.log('\n');
    
    // 等待 1 秒
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // 4. 编辑文章
    console.log('✏️ 步骤 4: 编辑文章');
    await testUpdateArticle(articleId);
    console.log('\n');
    
    // 等待 1 秒
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // 5. 再次查看详情
    console.log('🔍 步骤 5: 验证更新结果');
    await testGetArticleDetail(articleId);
    console.log('\n');
    
    // 6. 搜索测试
    console.log('🔎 步骤 6: 搜索文章');
    await testSearchArticle('测试');
    console.log('\n');
    
    console.log('✨ 测试完成！');
    console.log(`💡 测试文章 ID: ${articleId}`);
    console.log('💡 你可以在页面上查看这篇文章，或运行 testDeleteArticle() 删除它');
    
  } catch (error) {
    console.error('❌ 测试过程中出错:', error);
  }
}

// 运行完整测试
runFullTest();
```

## 使用说明

1. **单个测试**：复制单个测试函数到控制台运行
2. **完整测试**：复制所有函数定义和 `runFullTest()` 到控制台运行
3. **查看结果**：测试结果会直接显示在控制台中
4. **清理数据**：测试完成后可以运行 `testDeleteArticle()` 删除测试文章

## 常见问题

### Q: 提示 "未授权" 错误
A: 确保你已经登录，并且 localStorage 中有 token

### Q: 提示 "文章不存在" 错误
A: 检查文章 ID 是否正确，或者先运行创建文章的测试

### Q: 网络请求失败
A: 检查 Netlify Dev 是否正在运行，端口是否正确

### Q: 如何查看详细的请求信息
A: 切换到 Network 标签，可以看到所有的 HTTP 请求和响应
